<?php

use Fichier\Entity\Db\NatureFichier;
use These\Entity\Db\These;
use Fichier\Entity\Db\VersionFichier;
use Fichier\Provider\Privilege\FichierPrivileges;
use Application\View\Renderer\PhpRenderer;

/**
 * @var PhpRenderer    $this
 * @var These          $these
 * @var string         $uploadUrl
 * @var string         $fichiersListUrl
 * @var NatureFichier  $nature
 * @var VersionFichier $version
 * @var bool           $isVisible
 * @var int            $maxUploadableFilesCount
 */

$canEdit = $this->isAllowed($these, $p = FichierPrivileges::privilegeTeleverserFor($nature, $version));
$maxUploadableFilesCount = isset($maxUploadableFilesCount) ? $maxUploadableFilesCount : 1;
$isVisible = isset($isVisible) ? $isVisible : true;
?>

<?php if ($isVisible): ?>

<div class="box card">
    <div class="card-header bg-dark text-white">
        <h2 class="first"><?php echo $nature ?></h2>
    </div>
    <div class="card-body">
        <?php echo $this->partial('these/these/depot/partial/fichier', [
            'canUpload'               => $canEdit,
            'class'                   => (new NatureFichier)->setCode($nature->getCode())->getCodeToLowerAndDash(),
            'uploadUrl'               => $uploadUrl,
            'uploadedFilesListUrl'    => $fichiersListUrl,
            'maxUploadableFilesCount' => $maxUploadableFilesCount,
        ]) ?>
    </div>
</div>

<?php endif ?>
