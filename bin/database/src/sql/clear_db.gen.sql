--
-- Génération des ordres SQL pour vider la base de données.
--

with tmp(cat, name, sql) as (
    select 'a', viewname, 'drop view if exists '||viewname||' cascade ;' from pg_views where schemaname = 'public'
    union all
    select 'b', matviewname, 'drop materialized view if exists '||matviewname||' ;' from pg_matviews where schemaname = 'public'
    union all
    select 'c', tablename, 'drop table if exists '||tablename||' cascade ;' from pg_tables where schemaname = 'public'
    union all
    select 'd', sequencename, 'drop sequence if exists '||sequencename||' cascade ;' from pg_sequences where schemaname = 'public'
    union all
    select 'e', routine_name, 'drop '||routine_type||' if exists '||routine_name||' ;' from information_schema.routines where routine_definition is not null and specific_schema = 'public'
)
select sql from tmp
order by cat, name
;

/** Exemple de résultat :

drop view if exists src_acteur cascade ;
drop view if exists src_doctorant cascade ;
drop view if exists src_ecole_doct cascade ;
drop view if exists src_etablissement cascade ;
drop view if exists src_financement cascade ;
drop view if exists src_individu cascade ;
drop view if exists src_origine_financement cascade ;
drop view if exists src_role cascade ;
drop view if exists src_structure cascade ;
drop view if exists src_these cascade ;
drop view if exists src_these_annee_univ cascade ;
drop view if exists src_titre_acces cascade ;
drop view if exists src_unite_rech cascade ;
drop view if exists src_variable cascade ;
drop view if exists v_diff_acteur cascade ;
drop view if exists v_diff_doctorant cascade ;
drop view if exists v_diff_ecole_doct cascade ;
drop view if exists v_diff_etablissement cascade ;
drop view if exists v_diff_financement cascade ;
drop view if exists v_diff_individu cascade ;
drop view if exists v_diff_individu_indicateur cascade ;
drop view if exists v_diff_origine_financement cascade ;
drop view if exists v_diff_role cascade ;
drop view if exists v_diff_structure cascade ;
drop view if exists v_diff_these cascade ;
drop view if exists v_diff_these_annee_univ cascade ;
drop view if exists v_diff_titre_acces cascade ;
drop view if exists v_diff_unite_rech cascade ;
drop view if exists v_diff_variable cascade ;
drop view if exists v_individu_role cascade ;
drop view if exists v_situ_archivab_va cascade ;
drop view if exists v_situ_archivab_vac cascade ;
drop view if exists v_situ_archivab_vo cascade ;
drop view if exists v_situ_archivab_voc cascade ;
drop view if exists v_situ_attestations cascade ;
drop view if exists v_situ_attestations_voc cascade ;
drop view if exists v_situ_autoris_diff_these cascade ;
drop view if exists v_situ_autoris_diff_these_voc cascade ;
drop view if exists v_situ_depot_pv_sout cascade ;
drop view if exists v_situ_depot_rapport_sout cascade ;
drop view if exists v_situ_depot_va cascade ;
drop view if exists v_situ_depot_vac cascade ;
drop view if exists v_situ_depot_vc_valid_doct cascade ;
drop view if exists v_situ_depot_vc_valid_pres cascade ;
drop view if exists v_situ_depot_vc_valid_pres_new cascade ;
drop view if exists v_situ_depot_vo cascade ;
drop view if exists v_situ_depot_voc cascade ;
drop view if exists v_situ_rdv_bu_saisie_bu cascade ;
drop view if exists v_situ_rdv_bu_saisie_doct cascade ;
drop view if exists v_situ_rdv_bu_validation_bu cascade ;
drop view if exists v_situ_signalement_these cascade ;
drop view if exists v_situ_validation_page_couv cascade ;
drop view if exists v_situ_verif_va cascade ;
drop view if exists v_situ_verif_vac cascade ;
drop view if exists v_situ_version_papier_corrigee cascade ;
drop view if exists v_these_annee_univ_first cascade ;
drop view if exists v_tmp_anomalie cascade ;
drop view if exists v_wf_etape_pertin cascade ;
drop view if exists v_workflow cascade ;
drop materialized view if exists mv_indicateur_1 ;
drop materialized view if exists mv_indicateur_101 ;
drop materialized view if exists mv_indicateur_121 ;
drop materialized view if exists mv_indicateur_141 ;
drop materialized view if exists mv_indicateur_2 ;
drop materialized view if exists mv_indicateur_21 ;
drop materialized view if exists mv_indicateur_3 ;
drop materialized view if exists mv_indicateur_4 ;
drop materialized view if exists mv_indicateur_5 ;
drop materialized view if exists mv_indicateur_6 ;
drop materialized view if exists mv_indicateur_61 ;
drop materialized view if exists mv_indicateur_62 ;
drop materialized view if exists mv_indicateur_7 ;
drop materialized view if exists mv_indicateur_81 ;
drop materialized view if exists mv_recherche_these ;
drop table if exists acteur ;
drop table if exists api_log ;
drop table if exists attestation ;
drop table if exists categorie_privilege ;
drop table if exists diffusion ;
drop table if exists doctorant ;
drop table if exists doctorant_compl ;
drop table if exists domaine_scientifique ;
drop table if exists ecole_doct ;
drop table if exists etablissement ;
drop table if exists etablissement_rattach ;
drop table if exists faq ;
drop table if exists fichier ;
drop table if exists fichier_these ;
drop table if exists financement ;
drop table if exists import_log ;
drop table if exists import_notif ;
drop table if exists import_obs_notif ;
drop table if exists import_obs_result_notif ;
drop table if exists import_observ ;
drop table if exists import_observ_result ;
drop table if exists indicateur ;
drop table if exists individu ;
drop table if exists individu_rech ;
drop table if exists individu_role ;
drop table if exists information ;
drop table if exists information_fichier_sav ;
drop table if exists information_langue ;
drop table if exists liste_diff ;
drop table if exists mail_confirmation ;
drop table if exists metadonnee_these ;
drop table if exists nature_fichier ;
drop table if exists notif ;
drop table if exists notif_result ;
drop table if exists origine_financement ;
drop table if exists parametre ;
drop table if exists privilege ;
drop table if exists profil ;
drop table if exists profil_privilege ;
drop table if exists profil_to_role ;
drop table if exists rapport_annuel ;
drop table if exists rdv_bu ;
drop table if exists role ;
drop table if exists role_privilege ;
drop table if exists source ;
drop table if exists soutenance_avis ;
drop table if exists soutenance_configuration ;
drop table if exists soutenance_etat ;
drop table if exists soutenance_intervention ;
drop table if exists soutenance_justificatif ;
drop table if exists soutenance_membre ;
drop table if exists soutenance_proposition ;
drop table if exists soutenance_qualite ;
drop table if exists soutenance_qualite_sup ;
drop table if exists structure ;
drop table if exists structure_substit ;
drop table if exists sync_log ;
drop table if exists synchro_log ;
drop table if exists these ;
drop table if exists these_annee_univ ;
drop table if exists titre_acces ;
drop table if exists tmp_acteur ;
drop table if exists tmp_doctorant ;
drop table if exists tmp_ecole_doct ;
drop table if exists tmp_etablissement ;
drop table if exists tmp_financement ;
drop table if exists tmp_individu ;
drop table if exists tmp_origine_financement ;
drop table if exists tmp_role ;
drop table if exists tmp_structure ;
drop table if exists tmp_these ;
drop table if exists tmp_these_annee_univ ;
drop table if exists tmp_titre_acces ;
drop table if exists tmp_unite_rech ;
drop table if exists tmp_variable ;
drop table if exists type_structure ;
drop table if exists type_validation ;
drop table if exists unite_domaine_linker ;
drop table if exists unite_rech ;
drop table if exists utilisateur ;
drop table if exists validation ;
drop table if exists validite_fichier ;
drop table if exists variable ;
drop table if exists version_fichier ;
drop table if exists wf_etape ;
drop sequence if exists acteur_id_seq ;
drop sequence if exists api_log_id_seq ;
drop sequence if exists attestation_id_seq ;
drop sequence if exists categorie_privilege_id_seq ;
drop sequence if exists diffusion_id_seq ;
drop sequence if exists doctorant_compl_id_seq ;
drop sequence if exists doctorant_id_seq ;
drop sequence if exists domaine_scientifique_id_seq ;
drop sequence if exists ecole_doct_id_seq ;
drop sequence if exists etablissement_id_seq ;
drop sequence if exists etablissement_rattach_id_seq ;
drop sequence if exists faq_id_seq ;
drop sequence if exists fichier_id_seq ;
drop sequence if exists fichier_these_id_seq ;
drop sequence if exists financement_id_seq ;
drop sequence if exists import_notif_id_seq ;
drop sequence if exists import_observ_etab_id_seq ;
drop sequence if exists import_observ_etab_resu_id_seq ;
drop sequence if exists import_observ_id_seq ;
drop sequence if exists import_observ_result_id_seq ;
drop sequence if exists indicateur_id_seq ;
drop sequence if exists individu_id_seq ;
drop sequence if exists individu_role_id_seq ;
drop sequence if exists information_fichier_id_seq ;
drop sequence if exists information_id_seq ;
drop sequence if exists liste_diff_id_seq ;
drop sequence if exists mail_confirmation_id_seq ;
drop sequence if exists metadonnee_these_id_seq ;
drop sequence if exists nature_fichier_id_seq ;
drop sequence if exists notif_id_seq ;
drop sequence if exists notif_result_id_seq ;
drop sequence if exists origine_financement_id_seq ;
drop sequence if exists privilege_id_seq ;
drop sequence if exists profil_id_seq ;
drop sequence if exists rapport_annuel_id_seq ;
drop sequence if exists rdv_bu_id_seq ;
drop sequence if exists role_id_seq ;
drop sequence if exists soutenance_avis_id_seq ;
drop sequence if exists soutenance_etat_id_seq ;
drop sequence if exists soutenance_intervention_id_seq ;
drop sequence if exists soutenance_justificatif_id_seq ;
drop sequence if exists soutenance_membre_id_seq ;
drop sequence if exists soutenance_proposition_id_seq ;
drop sequence if exists soutenance_qualite_id_seq ;
drop sequence if exists soutenance_qualite_sup_id_seq ;
drop sequence if exists structure_id_seq ;
drop sequence if exists structure_substit_id_seq ;
drop sequence if exists sync_log_id_seq ;
drop sequence if exists synchro_log_id_seq ;
drop sequence if exists these_annee_univ_id_seq ;
drop sequence if exists these_id_seq ;
drop sequence if exists titre_acces_id_seq ;
drop sequence if exists unite_rech_id_seq ;
drop sequence if exists utilisateur_id_seq ;
drop sequence if exists validation_id_seq ;
drop sequence if exists validite_fichier_id_seq ;
drop sequence if exists variable_id_seq ;
drop sequence if exists wf_etape_id_seq ;
drop FUNCTION if exists comprise_entre ;
drop FUNCTION if exists individu_haystack ;
drop FUNCTION if exists str_reduce ;
drop FUNCTION if exists trigger_fct_individu_rech_update ;
*/