# Version 5.2.7

## 1. Sur le serveur d'application

- Placez-vous dans le répertoire de l'application puis lancez la commande suivante
  pour installer la nouvelle version :

```bash
git fetch --tags && git checkout --force 5.2.7 && bash ./install.sh
```

- Selon le moteur PHP que vous avez installé, rechargez le service, exemple :
    - php7.4-fpm         : `service php7.4-fpm reload`
    - apache2-mod-php7.4 : `service apache2 reload`

## 2. Dans la base de données

```sql
alter table formation_session add date_fermeture_inscription timestamp;

update role set type_structure_dependant_id=null where code='FORMATEUR';

INSERT INTO nature_fichier (id, code, libelle) select nextval('nature_fichier_id_seq'), 'CONV_FORMATION_DOCTORALE', 'Convention de formation doctorale';
INSERT INTO nature_fichier (id, code, libelle) select nextval('nature_fichier_id_seq'), 'CONV_FORMATION_DOCTORALE_AVENANT', 'Avenant à la convention de formation doctorale';
INSERT INTO nature_fichier (id, code, libelle) select nextval('nature_fichier_id_seq'), 'CHARTE_DOCTORAT', 'Charte du doctorat';
INSERT INTO nature_fichier (id, code, libelle) select nextval('nature_fichier_id_seq'), 'CHARTE_DOCTORAT_AVENANT', 'Avenant à la charte du doctorat';
update nature_fichier set code = 'CONV_MISE_EN_LIGNE_AVENANT' where code = 'AVENANT_CONV_MISE_EN_LIGNE';

update privilege set code = 'modifier-email-contact', libelle =	'Modifier l''email de contact du doctorant' where code = 'modification-persopass';
update privilege set code = 'afficher-email-contact', libelle =	'Visualiser l''email de contact du doctorant' where code = 'afficher-mail-contact';

alter table mail_confirmation add refus_liste_diff boolean default false not null;
comment on column mail_confirmation.refus_liste_diff is 'Refus de recevoir les messages des listes de diffusion sur cette adresse';

comment on table doctorant_compl is 'Table obsolète conservée un temps';
alter table doctorant_compl rename to z_doctorant_compl;

alter table step_star_log add tag varchar(64);
```
