# Version 6.0.8

## 1. Sur le serveur d'application

*Rappel : depuis la version 6.0.0, la version de PHP requise est la 8.0.*

- Placez-vous dans le répertoire de l'application puis lancez la commande suivante
  pour installer la nouvelle version :

```bash
git fetch --tags && git checkout --force 6.0.8 && bash ./install.sh
```

- Rechargez le moteur PHP, exemple :

```bash
systemctl reload php8.0-fpm
```

## 2. Dans la base de données

```postgresql
CREATE UNIQUE INDEX soutenance_proposition_uniq ON soutenance_proposition(these_id) WHERE (histo_destruction is null);
CREATE UNIQUE INDEX soutenance_proposition_uniq_histo ON soutenance_proposition(these_id, histo_destruction) WHERE (histo_destruction is not null);

INSERT INTO unicaen_renderer_macro (code, description, variable_name, methode_name) VALUES
('Url#Enquete', '<p>Ajoute le lien vers l''enquête</p>', 'Url', 'getUrlEnquete');

-- 
-- Rôle 'Authentifié'
--
delete from role where source_code = 'SyGAL::user';

insert into role (id, code, libelle, source_code, source_id, role_id, is_default, attrib_auto, these_dep,
                  histo_createur_id, ordre_affichage)
select nextval('role_id_seq'),
       'user',
       'Authentifié·e',
       'user',
       1,
       'user',
       false,
       false,
       false,
       1,
       'a'
on conflict (source_code) do update
  set libelle           = excluded.libelle,
      code              = excluded.code,
      source_code       = excluded.source_code,
      source_id         = excluded.source_id,
      role_id           = excluded.role_id,
      is_default        = excluded.is_default,
      attrib_auto       = excluded.attrib_auto,
      these_dep         = excluded.these_dep,
      histo_createur_id = excluded.histo_createur_id,
      ordre_affichage   = excluded.ordre_affichage;

```