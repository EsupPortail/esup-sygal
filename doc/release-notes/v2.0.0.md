# Version 2.0.0

## 1. Sur le serveur d'application
  
- ATTENTION : l'application requiert désormais PHP 7.3. 
  Vous devez donc mettre à jour la version de PHP (module Apache/FPM, et CLI) installée sur votre serveur.
    
- Ensuite, placez-vous dans le répertoire de l'application puis lancez la commande suivante 
  pour installer la nouvelle version de SyGAL :

```bash
git fetch --tags && git checkout --force 2.0.0 && \
bash ./install.sh
```

- Selon le moteur PHP que vous avez installé, rechargez le service, exemple :
  - php7.3-fpm         : `service php7.3-fpm reload`
  - apache2-mod-php7.3 : `service apache2 reload`

- Corrigez la section `Import des données des établissements` de la config CRON `/etc/cron.d/sygal` comme suit :
```
##### Import des données des établissements #####
*/20 7-19 * * 1-5 root ETAB=XXXX $APP_DIR/bin/run-import.sh >>/tmp/sygal-import-ws-cron-XXXX.log 2>&1
```
où `XXXX` est le "SOURCE_CODE" de votre établissement dans la table `ETABLISSEMENT`.


## 2. Dans la base de données

### Module Soutenance

```sql
-- -----------------------------------------------------------------------------
-- QUALITE [0/8 => 2/8]
-- -----------------------------------------------------------------------------

create table SOUTENANCE_QUALITE
(
    ID NUMBER not null primary key,
    LIBELLE VARCHAR2(128) not null,
    RANG VARCHAR2(1) not null,
    HDR VARCHAR2(1) not null,
    EMERITAT VARCHAR2(1) not null,
    HISTO_CREATION DATE not null,
    HISTO_CREATEUR_ID NUMBER not null constraint SQUALITE_UTILISATEUR_ID_FK_1 references UTILISATEUR,
    HISTO_MODIFICATION DATE not null,
    HISTO_MODIFICATEUR_ID NUMBER not null constraint SQUALITE_UTILISATEUR_ID_FK_2 references UTILISATEUR,
    HISTO_DESTRUCTION DATE,
    HISTO_DESTRUCTEUR_ID NUMBER constraint SQUALITE_UTILISATEUR_ID_FK_3 references UTILISATEUR
)
;

create table SOUTENANCE_QUALITE_SUP
(
    ID NUMBER not null primary key,
    QUALITE_ID NUMBER not null constraint SQS_QUALITE_FK references SOUTENANCE_QUALITE on delete cascade,
    LIBELLE VARCHAR2(255) not null,
    HISTO_CREATION DATE not null,
    HISTO_CREATEUR_ID NUMBER not null constraint SQS_CREATEUR_FK references UTILISATEUR,
    HISTO_MODIFICATION DATE not null,
    HISTO_MODIFICATEUR_ID NUMBER not null constraint SQS_MODIFICATEUR_FK references UTILISATEUR,
    HISTO_DESTRUCTION DATE,
    HISTO_DESTRUCTEUR_ID NUMBER constraint SQS_DESTRUCTEUR_FK references UTILISATEUR
);

create sequence SOUTENANCE_QUALITE_ID_SEQ;
create sequence SOUTENANCE_QUALITE_SUP_ID_SEQ;

-- -----------------------------------------------------------------------------
-- ETAT [2/8 => 3/8]
-- -----------------------------------------------------------------------------

create table SOUTENANCE_ETAT
(
    ID NUMBER not null primary key,
    CODE VARCHAR2(63) not null,
    LIBELLE VARCHAR2(255) not null,
    HISTO_CREATION DATE not null,
    HISTO_CREATEUR_ID NUMBER not null,
    HISTO_MODIFICATION DATE not null,
    HISTO_MODIFICATEUR_ID NUMBER not null,
    HISTO_DESTRUCTION DATE,
    HISTO_DESTRUCTEUR_ID NUMBER
)
;

create sequence SOUTENANCE_ETAT_ID_SEQ;

-------------------------------------------------------------------------------
--- CONFIGURATION [3/8 => 4/8]
-------------------------------------------------------------------------------

create table SOUTENANCE_CONFIGURATION
(
    ID NUMBER not null primary key,
    CODE VARCHAR2(64) not null,
    LIBELLE VARCHAR2(256),
    VALEUR VARCHAR2(128)
);

create unique index CONFIGURATION_CODE_UINDEX on SOUTENANCE_CONFIGURATION (CODE);

-------------------------------------------------------------------------------
--- PROPOSITION [4/8 => 5/8]
-------------------------------------------------------------------------------

create table SOUTENANCE_PROPOSITION
(
    ID NUMBER not null primary key,
    THESE_ID NUMBER not null constraint PROPOSITION_THESE_FK references THESE on delete cascade,
    DATEPREV DATE,
    LIEU VARCHAR2(256),
    RENDU_RAPPORT DATE,
    CONFIDENTIALITE DATE,
    LABEL_EUROPEEN NUMBER default 0 not null,
    MANUSCRIT_ANGLAIS NUMBER default 0 not null,
    SOUTENANCE_ANGLAIS NUMBER default 0 not null,
    HUIT_CLOS NUMBER default 0 not null,
    EXTERIEUR NUMBER default 0 not null,
    NOUVEAU_TITRE VARCHAR2(2048),
    ETAT_ID NUMBER not null constraint SOUTENANCE_ETAT_ID_FK references SOUTENANCE_ETAT on delete set null,
    SURSIS VARCHAR2(1),
    ADRESSE_EXACTE VARCHAR2(2048),
    HISTO_CREATION DATE not null,
    HISTO_CREATEUR_ID NUMBER not null constraint PROPOSITION_CREATEUR_FK references UTILISATEUR,
    HISTO_MODIFICATION DATE not null,
    HISTO_MODIFICATEUR_ID NUMBER not null constraint PROPOSITION_MODIFICATEUR_FK references UTILISATEUR,
    HISTO_DESTRUCTION DATE,
    HISTO_DESTRUCTEUR_ID NUMBER constraint PROPOSITION_DESTRUCTEUR_FK references UTILISATEUR
);

create sequence SOUTENANCE_PROPOSITION_ID_SEQ;

-------------------------------------------------------------------------------
--- MEMBRE [5/8 => 6/8]
-------------------------------------------------------------------------------

create table SOUTENANCE_MEMBRE
(
    ID NUMBER not null primary key,
    PROPOSITION_ID NUMBER not null constraint MEMBRE_PROPOSITION_FK references SOUTENANCE_PROPOSITION on delete cascade,
    GENRE VARCHAR2(1) not null,
    QUALITE NUMBER default NULL not null constraint MEMBRE_QUALITE_FK references SOUTENANCE_QUALITE on delete set null,
    ETABLISSEMENT VARCHAR2(128) not null,
    ROLE_ID VARCHAR2(64) not null,
    EXTERIEUR VARCHAR2(3),
    EMAIL VARCHAR2(256) default NULL,
    ACTEUR_ID NUMBER constraint SOUTEMEMBRE_ACTEUR_FK references ACTEUR on delete cascade,
    VISIO NUMBER default 0 not null,
    NOM VARCHAR2(256),
    PRENOM VARCHAR2(256),
    HISTO_CREATION DATE not null,
    HISTO_CREATEUR_ID NUMBER not null constraint MEMBRE_CREATEUR_FK references UTILISATEUR,
    HISTO_MODIFICATION DATE not null,
    HISTO_MODIFICATEUR_ID NUMBER not null constraint MEMBRE_MODIFICATEUR_FK references UTILISATEUR,
    HISTO_DESTRUCTION DATE,
    HISTO_DESTRUCTEUR_ID NUMBER constraint MEMBRE_DESTRUCTEUR_FK references UTILISATEUR
);

create sequence SOUTENANCE_MEMBRE_ID_SEQ;

-------------------------------------------------------------------------------
--- JUSTIFICATIF [6/8 => 7/8]
-------------------------------------------------------------------------------

create table SOUTENANCE_JUSTIFICATIF
(
    ID NUMBER not null constraint SOUTENANCE_JUSTIFICATIF_PK primary key,
    PROPOSITION_ID NUMBER not null constraint JUSTIFICATIF_PROPOSITION_FK references SOUTENANCE_PROPOSITION on delete cascade,
    FICHIER_ID NUMBER not null constraint JUSTIFICATIF_FICHIER_FK references FICHIER_THESE on delete cascade,
    MEMBRE_ID NUMBER constraint JUSTIFICATIF_MEMBRE_FK references SOUTENANCE_MEMBRE on delete set null,
    HISTO_CREATION DATE not null,
    HISTO_CREATEUR_ID NUMBER not null constraint JUSTIFICATIF_CREATEUR_FK references UTILISATEUR,
    HISTO_MODIFICATION DATE not null,
    HISTO_MODIFICATEUR_ID NUMBER not null constraint JUSTIFICATIF_MODIFICATEUR_FK references UTILISATEUR,
    HISTO_DESTRUCTION DATE,
    HISTO_DESTRUCTEUR_ID NUMBER constraint JUSTIFICATIF_DESTRUCTEUR_FK references UTILISATEUR
);

create sequence SOUTENANCE_JUSTIFICATIF_ID_SEQ;

-------------------------------------------------------------------------------
--- AVIS [7/8 => 8/8]
-------------------------------------------------------------------------------

create table SOUTENANCE_AVIS
(
    ID NUMBER not null,
    PROPOSITION_ID NUMBER not null constraint AVIS_PROPOSITION_ID references SOUTENANCE_PROPOSITION on delete cascade,
    MEMBRE_ID NUMBER not null constraint AVIS_MEMBRE_FK references SOUTENANCE_MEMBRE on delete cascade,
    AVIS VARCHAR2(64),
    MOTIF VARCHAR2(1024),
    VALIDATION_ID NUMBER constraint AVIS_VALIDATION_FK references VALIDATION,
    FICHIER_ID NUMBER default NULL constraint AVIS_FICHIER_ID_FK references FICHIER,
    HISTO_CREATION DATE not null,
    HISTO_CREATEUR_ID NUMBER not null,
    HISTO_MODIFICATION DATE not null,
    HISTO_MODIFICATEUR_ID NUMBER not null constraint AVIS_MODIFICATEUR_FK references UTILISATEUR,
    HISTO_DESTRUCTION DATE,
    HISTO_DESTRUCTEUR_ID NUMBER constraint AVIS_DESTRUCTEUR_ID references UTILISATEUR
);

create sequence SOUTENANCE_AVIS_ID_SEQ;

-------------------------------------------------------------------------------
--- CONFIG
-------------------------------------------------------------------------------

INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (1, 'AVIS_DEADLINE', 'Nombre de jours avant soutenance pour le retour des rapports', '14');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (2, 'JURY_SIZE_MIN', 'Nombre minimal de membre de jury', '4');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (3, 'JURY_SIZE_MAX', 'Nombre maximal de membre de jury', '8');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (4, 'JURY_RAPPORTEUR_SIZE_MIN', 'Nombre minimal de rapporteur', '2');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (5, 'JURY_RANGA_RATIO_MIN', 'Ratio minimal de membre de rang A', '0.5');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (6, 'JURY_EXTERIEUR_RATIO_MIN', 'Ratio minimal de membre exterieur', '0.50');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (7, 'JURY_PARITE_RATIO_MIN', 'Ratio minimal sur la parity du jury', '0');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (8, 'PROPOSITION_ORDRE_VALIDATION_ACTEUR', 'Ordre de validation de la proposition pour les acteurs directs', '1');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (9, 'PROPOSITION_ORDRE_VALIDATION_UR', 'Ordre de validation de la proposition pour l''unité de recherche', '2');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (10, 'PROPOSITION_ORDRE_VALIDATION_ED', 'Ordre de validation de la proposition pour l''école doctorale', '3');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (11, 'PROPOSITION_ORDRE_VALIDATION_BDD', 'Ordre de validation de la proposition pour le bureau des doctorats', '4');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (12, 'PROPOSITION_ORDRE_VALIDATION_PRESIDENT', 'Ordre de validation de la proposition pour le président', '-1');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (13, 'FORMULAIRE_DELOCALISATION', 'Formulaire de demande de délocalisation de la soutenance', 'https://sygal.normandie-univ.fr/informations/fichiers/telecharger/8716');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (14, 'FORMULAIRE_DELEGUATION', 'Formulaire de demande de déléguation de signature', 'https://sygal.normandie-univ.fr/informations/fichiers/telecharger/8714');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (15, 'FORMULAIRE_LABEL_EUROPEEN', 'Formulaire de demande de label européen', 'https://sygal-test.normandie-univ.fr/informations/fichiers/telecharger/802');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (16, 'FORMULAIRE_THESE_ANGLAIS', 'Formulaire de demande de rédaction en anglais', 'https://sygal-test.normandie-univ.fr/informations/fichiers/telecharger/1541');
INSERT INTO SOUTENANCE_CONFIGURATION (ID, CODE, LIBELLE, VALEUR) VALUES (17, 'FORMULAIRE_CONFIDENTIALITE', 'Formulaire de de mande de confidentialité', 'https://sygal.normandie-univ.fr/informations/fichiers/telecharger/8715');

-------------------------------------------------------------------------------
--- ETAT
-------------------------------------------------------------------------------

INSERT INTO SOUTENANCE_ETAT (ID, CODE, LIBELLE, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) select SOUTENANCE_ETAT_ID_SEQ.nextval, 'EN_COURS', 'En cours d''examen', TO_DATE('2020-09-21 10:50:03', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 10:50:03', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null from dual;
INSERT INTO SOUTENANCE_ETAT (ID, CODE, LIBELLE, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) select SOUTENANCE_ETAT_ID_SEQ.nextval, 'VALIDEE', 'Soutenance autorisée', TO_DATE('2020-09-21 10:50:04', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 10:50:04', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null from dual;
INSERT INTO SOUTENANCE_ETAT (ID, CODE, LIBELLE, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) select SOUTENANCE_ETAT_ID_SEQ.nextval, 'REJETEE', 'Soutenance rejetée', TO_DATE('2020-09-21 10:50:04', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 10:50:04', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null from dual;

-------------------------------------------------------------------------------
--- QUALITE
-------------------------------------------------------------------------------

INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (7, 'Professeur émerite', 'A', 'O', 'O', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (8, 'Chargé de Recherche (HDR)', 'B', 'O', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (9, 'Ingénieur de Recherche ', 'B', 'N', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (10, 'Ingénieur de Recherche (HDR)', 'B', 'O', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (11, 'Ingénieur d''Etude ', 'B', 'N', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (0, 'Qualité inconnue', 'B', 'N', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (12, 'Autre', 'B', 'N', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (1, 'Professeur des universités', 'A', 'O', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (2, 'Directeur de recherche', 'A', 'O', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (4, 'Maître de conférences', 'B', 'N', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (5, 'Chargé de recherche', 'B', 'N', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE (ID, LIBELLE, RANG, HDR, EMERITAT, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (6, 'Maître de conférences (HDR)', 'B', 'O', 'N', TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2020-09-21 11:05:34', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);

ALTER SEQUENCE SOUTENANCE_QUALITE_ID_SEQ INCREMENT BY 13;
select SOUTENANCE_QUALITE_ID_SEQ.nextval from dual;
ALTER SEQUENCE SOUTENANCE_QUALITE_ID_SEQ INCREMENT BY 1;

INSERT INTO SOUTENANCE_QUALITE_SUP (ID, QUALITE_ID, LIBELLE, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (1, 5, 'CHARGE DE RECHERCHE', TO_DATE('2019-12-17 10:01:15', 'YYYY-MM-DD HH24:MI:SS'), 1, TO_DATE('2019-12-17 10:01:22', 'YYYY-MM-DD HH24:MI:SS'), 1, null, null);
INSERT INTO SOUTENANCE_QUALITE_SUP (ID, QUALITE_ID, LIBELLE, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (4, 1, 'PROFESSEUR DES UNIVERSITES', TO_DATE('2019-12-17 11:54:12', 'YYYY-MM-DD HH24:MI:SS'), 1446, TO_DATE('2019-12-17 11:54:12', 'YYYY-MM-DD HH24:MI:SS'), 1446, null, null);
INSERT INTO SOUTENANCE_QUALITE_SUP (ID, QUALITE_ID, LIBELLE, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (2, 2, 'DIRECTEUR DE RECHERCHE', TO_DATE('2019-12-17 11:26:10', 'YYYY-MM-DD HH24:MI:SS'), 1446, TO_DATE('2019-12-17 11:26:10', 'YYYY-MM-DD HH24:MI:SS'), 1446, null, null);
INSERT INTO SOUTENANCE_QUALITE_SUP (ID, QUALITE_ID, LIBELLE, HISTO_CREATION, HISTO_CREATEUR_ID, HISTO_MODIFICATION, HISTO_MODIFICATEUR_ID, HISTO_DESTRUCTION, HISTO_DESTRUCTEUR_ID) VALUES (3, 1, 'PROFESSEUR DES UNIVERSITÉS', TO_DATE('2019-12-17 11:27:29', 'YYYY-MM-DD HH24:MI:SS'), 1446, TO_DATE('2019-12-17 11:27:29', 'YYYY-MM-DD HH24:MI:SS'), 1446, null, null);

ALTER SEQUENCE SOUTENANCE_QUALITE_SUP_ID_SEQ INCREMENT BY 5;
select SOUTENANCE_QUALITE_SUP_ID_SEQ.nextval from dual;
ALTER SEQUENCE SOUTENANCE_QUALITE_SUP_ID_SEQ INCREMENT BY 1;

-------------------------------------------------------------------------------
--- NATURE DOCUMENT
-------------------------------------------------------------------------------

INSERT INTO NATURE_FICHIER (ID, CODE, LIBELLE) select NATURE_FICHIER_ID_SEQ.nextval, 'JUSTIFICATIF_HDR', 'Justificatif d''habilitation à diriger des recherches' from dual;
INSERT INTO NATURE_FICHIER (ID, CODE, LIBELLE) select NATURE_FICHIER_ID_SEQ.nextval, 'DELOCALISATION_SOUTENANCE', 'Formulaire de délocalisation de soutenance' from dual;
INSERT INTO NATURE_FICHIER (ID, CODE, LIBELLE) select NATURE_FICHIER_ID_SEQ.nextval, 'DELEGUATION_SIGNATURE', 'Formulaire de délégation de signature du rapport de soutenance (visioconférence)' from dual;
INSERT INTO NATURE_FICHIER (ID, CODE, LIBELLE) select NATURE_FICHIER_ID_SEQ.nextval, 'DEMANDE_LABEL_EUROPEEN', 'Formulaire de demande de label européen' from dual;
INSERT INTO NATURE_FICHIER (ID, CODE, LIBELLE) select NATURE_FICHIER_ID_SEQ.nextval, 'DEMANDE_LANGUE_ANGLAISE', 'Formulaire de demande de manuscrit ou de soutenance en anglais' from dual;
INSERT INTO NATURE_FICHIER (ID, CODE, LIBELLE) select NATURE_FICHIER_ID_SEQ.nextval, 'JUSTIFICATIF_EMERITAT', 'Justificatif d''émeritat' from dual;
INSERT INTO NATURE_FICHIER (ID, CODE, LIBELLE) select NATURE_FICHIER_ID_SEQ.nextval, 'AUTRES_JUSTIFICATIFS', 'Autres justificatifs concernant la soutenance' from dual;

-------------------------------------------------------------------------------
--- TYPE VALIDATION
-------------------------------------------------------------------------------

INSERT INTO TYPE_VALIDATION (ID, CODE, LIBELLE) VALUES (6, 'PROPOSITION_SOUTENANCE', 'Validation de la proposition de soutenance');
INSERT INTO TYPE_VALIDATION (ID, CODE, LIBELLE) VALUES (8, 'ENGAGEMENT_IMPARTIALITE', 'Signature de l''engagement d''impartialité');
INSERT INTO TYPE_VALIDATION (ID, CODE, LIBELLE) VALUES (9, 'VALIDATION_PROPOSITION_ED', 'Validation de la proposition de soutenance par l''école doctorale');
INSERT INTO TYPE_VALIDATION (ID, CODE, LIBELLE) VALUES (10, 'VALIDATION_PROPOSITION_UR', 'Validation de la proposition de soutenance par l''unité de recherche');
INSERT INTO TYPE_VALIDATION (ID, CODE, LIBELLE) VALUES (11, 'VALIDATION_PROPOSITION_BDD', 'Validation de la proposition de soutenance par le bureau des doctorats');
INSERT INTO TYPE_VALIDATION (ID, CODE, LIBELLE) VALUES (12, 'AVIS_SOUTENANCE', 'Signature de l''avis de soutenance');
INSERT INTO TYPE_VALIDATION (ID, CODE, LIBELLE) VALUES (13, 'REFUS_ENGAGEMENT_IMPARTIALITE', 'Refus de l''engagement d''impartialité');

-- GERER LES PROFILS MANQUANTS --> RAPPORTEUR ABSENT

INSERT INTO CATEGORIE_PRIVILEGE (ID, CODE, LIBELLE, ORDRE) values (101, 'soutenance', 'Soutenance', 1000);

INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (524, 101, 'proposition-sursis', 'Accorder un sursis pour la validation d''une Modifier la proposition de soutenance', 500);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (517, 101, 'proposition-presidence', 'Générer document pour la signature par la présidence', 34);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (518, 101, 'avis-annuler', 'Annuler un avis de soutenance', 400);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (519, 101, 'avis-notifier', 'Notifier les demandes d''avis de soutenance', 500);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (520, 101, 'index-global', 'Accès à l''index global', 1);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (521, 101, 'index-acteur', 'Accès à l''index acteur', 2);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (500, 101, 'modification-date-rapport', 'Modification de la date de rendu des rapports', 50);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (501, 101, 'association-membre-individu', 'Associer des individus aux membres de jury', 50);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (502, 101, 'proposition-visualisation', 'Visualier de la proposition de soutenance', 10);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (503, 101, 'proposition-modification', 'Modifier la proposition de soutenance', 20);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (504, 101, 'proposition-validation-acteur', 'Valider/Annuler la proposition de soutenance (acteur)', 30);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (505, 101, 'proposition-validation-ed', 'Valider/Annuler la proposition de soutenance (ecole-doctorale)', 31);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (506, 101, 'proposition-validation-ur', 'Valider/Annuler la proposition de soutenance (unite-recherche)', 32);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (507, 101, 'proposition-validation-bdd', 'Valider/Annuler la proposition de soutenance (bureau-doctorat)', 33);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (508, 101, 'engagement-impartialite-signer', 'Signer l''engagement d''impartialité ', 130);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (509, 101, 'engagement-impartialite-annuler', 'Annuler une signature  d''engagement d''impartialité', 140);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (510, 101, 'engagement-impartialite-visualiser', 'Visualiser un engagement d''impartialité', 100);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (511, 101, 'engagement-impartialite-notifier', 'Notifier des demandes de signature d''engagement d''impartialité', 110);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (512, 101, 'presoutenance-visualisation', 'Visualiser les informations associées à la présoutenance', 45);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (513, 101, 'avis-visualisation', 'Visualiser l''avis de soutenance et au rapport de présoutenance', 200);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (514, 101, 'avis-modifier', 'Modifier l''avis de soutenance et le rapport de présoutenance', 300);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (522, 101, 'index-rapporteur', 'Accès à l''index rapporteur', 3);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (515, 101, 'qualite-visualisation', 'Visualiser les qualités renseignées', 400);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (516, 101, 'qualite-modification', 'Ajout/Modification des qualités ', 410);
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES (523, 101, 'index-structure', 'Accès à l''index structure', 4);

INSERT INTO PROFIL (ID, LIBELLE, ROLE_ID, STRUCTURE_TYPE, DESCRIPTION) VALUES (101, 'Rapporteur Absent', 'A', 1, null);
```

### Autres

```sql

--
-- Suppression de THESE.ANNEE_UNIV_1ERE_INSC obsolète et posant problème au module unicaen/import.
--
create or replace view SRC_THESE as
select
    null                            as id,
    tmp.source_code                 as source_code,
    src.id                          as source_id,
    e.id                            as etablissement_id,
    d.id                            as doctorant_id,
    coalesce(ed_substit.id, ed.id)  as ecole_doct_id,
    coalesce(ur_substit.id, ur.id)  as unite_rech_id,
    tmp.lib_ths                     as titre,
    tmp.eta_ths                     as etat_these,
    to_number(tmp.cod_neg_tre)      as resultat,
    tmp.lib_int1_dis                as lib_disc,
    tmp.dat_deb_ths                 as date_prem_insc,
    tmp.dat_prev_sou                as date_prev_soutenance,
    tmp.dat_sou_ths                 as date_soutenance,
    tmp.dat_fin_cfd_ths             as date_fin_confid,
    tmp.lib_etab_cotut              as lib_etab_cotut,
    tmp.lib_pays_cotut              as lib_pays_cotut,
    tmp.correction_possible         as correc_autorisee,
    tem_sou_aut_ths                 as soutenance_autoris,
    dat_aut_sou_ths                 as date_autoris_soutenance,
    tem_avenant_cotut               as tem_avenant_cotut,
    dat_abandon                     as date_abandon,
    dat_transfert_dep               as date_transfert
from tmp_these tmp
         JOIN STRUCTURE s ON s.SOURCE_CODE = tmp.ETABLISSEMENT_ID
         join etablissement e on e.structure_id = s.id
         join source src on src.code = tmp.source_id
         join doctorant d on d.source_code = tmp.doctorant_id
         left join ecole_doct ed on ed.source_code = tmp.ecole_doct_id
         left join unite_rech ur on ur.source_code = tmp.unite_rech_id
         left join structure_substit ss_ed on ss_ed.from_structure_id = ed.structure_id
         left join ecole_doct ed_substit on ed_substit.structure_id = ss_ed.to_structure_id
         left join structure_substit ss_ur on ss_ur.from_structure_id = ur.structure_id
         left join unite_rech ur_substit on ur_substit.structure_id = ss_ur.to_structure_id
;

create or replace view V_DIFF_THESE as
select diff."ID",diff."SOURCE_ID",diff."SOURCE_CODE",diff."IMPORT_ACTION",diff."CORREC_AUTORISEE",diff."DATE_ABANDON",diff."DATE_AUTORIS_SOUTENANCE",diff."DATE_FIN_CONFID",diff."DATE_PREM_INSC",diff."DATE_PREV_SOUTENANCE",diff."DATE_SOUTENANCE",diff."DATE_TRANSFERT",diff."DOCTORANT_ID",diff."ECOLE_DOCT_ID",diff."ETABLISSEMENT_ID",diff."ETAT_THESE",diff."LIB_DISC",diff."LIB_ETAB_COTUT",diff."LIB_PAYS_COTUT",diff."RESULTAT",diff."SOUTENANCE_AUTORIS",diff."TEM_AVENANT_COTUT",diff."TITRE",diff."UNITE_RECH_ID",diff."U_CORREC_AUTORISEE",diff."U_DATE_ABANDON",diff."U_DATE_AUTORIS_SOUTENANCE",diff."U_DATE_FIN_CONFID",diff."U_DATE_PREM_INSC",diff."U_DATE_PREV_SOUTENANCE",diff."U_DATE_SOUTENANCE",diff."U_DATE_TRANSFERT",diff."U_DOCTORANT_ID",diff."U_ECOLE_DOCT_ID",diff."U_ETABLISSEMENT_ID",diff."U_ETAT_THESE",diff."U_LIB_DISC",diff."U_LIB_ETAB_COTUT",diff."U_LIB_PAYS_COTUT",diff."U_RESULTAT",diff."U_SOUTENANCE_AUTORIS",diff."U_TEM_AVENANT_COTUT",diff."U_TITRE",diff."U_UNITE_RECH_ID" from (SELECT
  COALESCE( D.id, S.id ) id,
  COALESCE( S.source_id, D.source_id ) source_id,
  COALESCE( S.source_code, D.source_code ) source_code,
CASE
    WHEN S.source_code IS NOT NULL AND D.source_code IS NULL THEN 'insert'
    WHEN S.source_code IS NOT NULL AND D.source_code IS NOT NULL AND (D.histo_destruction IS NULL OR D.histo_destruction > SYSDATE) THEN 'update'
    WHEN S.source_code IS NULL AND D.source_code IS NOT NULL AND (D.histo_destruction IS NULL OR D.histo_destruction > SYSDATE) THEN 'delete'
    WHEN S.source_code IS NOT NULL AND D.source_code IS NOT NULL AND D.histo_destruction IS NOT NULL AND D.histo_destruction <= SYSDATE THEN 'undelete' END import_action,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.CORREC_AUTORISEE ELSE S.CORREC_AUTORISEE END CORREC_AUTORISEE,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.DATE_ABANDON ELSE S.DATE_ABANDON END DATE_ABANDON,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.DATE_AUTORIS_SOUTENANCE ELSE S.DATE_AUTORIS_SOUTENANCE END DATE_AUTORIS_SOUTENANCE,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.DATE_FIN_CONFID ELSE S.DATE_FIN_CONFID END DATE_FIN_CONFID,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.DATE_PREM_INSC ELSE S.DATE_PREM_INSC END DATE_PREM_INSC,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.DATE_PREV_SOUTENANCE ELSE S.DATE_PREV_SOUTENANCE END DATE_PREV_SOUTENANCE,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.DATE_SOUTENANCE ELSE S.DATE_SOUTENANCE END DATE_SOUTENANCE,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.DATE_TRANSFERT ELSE S.DATE_TRANSFERT END DATE_TRANSFERT,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.DOCTORANT_ID ELSE S.DOCTORANT_ID END DOCTORANT_ID,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.ECOLE_DOCT_ID ELSE S.ECOLE_DOCT_ID END ECOLE_DOCT_ID,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.ETABLISSEMENT_ID ELSE S.ETABLISSEMENT_ID END ETABLISSEMENT_ID,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.ETAT_THESE ELSE S.ETAT_THESE END ETAT_THESE,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.LIB_DISC ELSE S.LIB_DISC END LIB_DISC,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.LIB_ETAB_COTUT ELSE S.LIB_ETAB_COTUT END LIB_ETAB_COTUT,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.LIB_PAYS_COTUT ELSE S.LIB_PAYS_COTUT END LIB_PAYS_COTUT,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.RESULTAT ELSE S.RESULTAT END RESULTAT,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.SOUTENANCE_AUTORIS ELSE S.SOUTENANCE_AUTORIS END SOUTENANCE_AUTORIS,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.TEM_AVENANT_COTUT ELSE S.TEM_AVENANT_COTUT END TEM_AVENANT_COTUT,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.TITRE ELSE S.TITRE END TITRE,
    CASE WHEN S.source_code IS NULL AND D.source_code IS NOT NULL THEN D.UNITE_RECH_ID ELSE S.UNITE_RECH_ID END UNITE_RECH_ID,
    CASE WHEN D.CORREC_AUTORISEE <> S.CORREC_AUTORISEE OR (D.CORREC_AUTORISEE IS NULL AND S.CORREC_AUTORISEE IS NOT NULL) OR (D.CORREC_AUTORISEE IS NOT NULL AND S.CORREC_AUTORISEE IS NULL) THEN 1 ELSE 0 END U_CORREC_AUTORISEE,
    CASE WHEN D.DATE_ABANDON <> S.DATE_ABANDON OR (D.DATE_ABANDON IS NULL AND S.DATE_ABANDON IS NOT NULL) OR (D.DATE_ABANDON IS NOT NULL AND S.DATE_ABANDON IS NULL) THEN 1 ELSE 0 END U_DATE_ABANDON,
    CASE WHEN D.DATE_AUTORIS_SOUTENANCE <> S.DATE_AUTORIS_SOUTENANCE OR (D.DATE_AUTORIS_SOUTENANCE IS NULL AND S.DATE_AUTORIS_SOUTENANCE IS NOT NULL) OR (D.DATE_AUTORIS_SOUTENANCE IS NOT NULL AND S.DATE_AUTORIS_SOUTENANCE IS NULL) THEN 1 ELSE 0 END U_DATE_AUTORIS_SOUTENANCE,
    CASE WHEN D.DATE_FIN_CONFID <> S.DATE_FIN_CONFID OR (D.DATE_FIN_CONFID IS NULL AND S.DATE_FIN_CONFID IS NOT NULL) OR (D.DATE_FIN_CONFID IS NOT NULL AND S.DATE_FIN_CONFID IS NULL) THEN 1 ELSE 0 END U_DATE_FIN_CONFID,
    CASE WHEN D.DATE_PREM_INSC <> S.DATE_PREM_INSC OR (D.DATE_PREM_INSC IS NULL AND S.DATE_PREM_INSC IS NOT NULL) OR (D.DATE_PREM_INSC IS NOT NULL AND S.DATE_PREM_INSC IS NULL) THEN 1 ELSE 0 END U_DATE_PREM_INSC,
    CASE WHEN D.DATE_PREV_SOUTENANCE <> S.DATE_PREV_SOUTENANCE OR (D.DATE_PREV_SOUTENANCE IS NULL AND S.DATE_PREV_SOUTENANCE IS NOT NULL) OR (D.DATE_PREV_SOUTENANCE IS NOT NULL AND S.DATE_PREV_SOUTENANCE IS NULL) THEN 1 ELSE 0 END U_DATE_PREV_SOUTENANCE,
    CASE WHEN D.DATE_SOUTENANCE <> S.DATE_SOUTENANCE OR (D.DATE_SOUTENANCE IS NULL AND S.DATE_SOUTENANCE IS NOT NULL) OR (D.DATE_SOUTENANCE IS NOT NULL AND S.DATE_SOUTENANCE IS NULL) THEN 1 ELSE 0 END U_DATE_SOUTENANCE,
    CASE WHEN D.DATE_TRANSFERT <> S.DATE_TRANSFERT OR (D.DATE_TRANSFERT IS NULL AND S.DATE_TRANSFERT IS NOT NULL) OR (D.DATE_TRANSFERT IS NOT NULL AND S.DATE_TRANSFERT IS NULL) THEN 1 ELSE 0 END U_DATE_TRANSFERT,
    CASE WHEN D.DOCTORANT_ID <> S.DOCTORANT_ID OR (D.DOCTORANT_ID IS NULL AND S.DOCTORANT_ID IS NOT NULL) OR (D.DOCTORANT_ID IS NOT NULL AND S.DOCTORANT_ID IS NULL) THEN 1 ELSE 0 END U_DOCTORANT_ID,
    CASE WHEN D.ECOLE_DOCT_ID <> S.ECOLE_DOCT_ID OR (D.ECOLE_DOCT_ID IS NULL AND S.ECOLE_DOCT_ID IS NOT NULL) OR (D.ECOLE_DOCT_ID IS NOT NULL AND S.ECOLE_DOCT_ID IS NULL) THEN 1 ELSE 0 END U_ECOLE_DOCT_ID,
    CASE WHEN D.ETABLISSEMENT_ID <> S.ETABLISSEMENT_ID OR (D.ETABLISSEMENT_ID IS NULL AND S.ETABLISSEMENT_ID IS NOT NULL) OR (D.ETABLISSEMENT_ID IS NOT NULL AND S.ETABLISSEMENT_ID IS NULL) THEN 1 ELSE 0 END U_ETABLISSEMENT_ID,
    CASE WHEN D.ETAT_THESE <> S.ETAT_THESE OR (D.ETAT_THESE IS NULL AND S.ETAT_THESE IS NOT NULL) OR (D.ETAT_THESE IS NOT NULL AND S.ETAT_THESE IS NULL) THEN 1 ELSE 0 END U_ETAT_THESE,
    CASE WHEN D.LIB_DISC <> S.LIB_DISC OR (D.LIB_DISC IS NULL AND S.LIB_DISC IS NOT NULL) OR (D.LIB_DISC IS NOT NULL AND S.LIB_DISC IS NULL) THEN 1 ELSE 0 END U_LIB_DISC,
    CASE WHEN D.LIB_ETAB_COTUT <> S.LIB_ETAB_COTUT OR (D.LIB_ETAB_COTUT IS NULL AND S.LIB_ETAB_COTUT IS NOT NULL) OR (D.LIB_ETAB_COTUT IS NOT NULL AND S.LIB_ETAB_COTUT IS NULL) THEN 1 ELSE 0 END U_LIB_ETAB_COTUT,
    CASE WHEN D.LIB_PAYS_COTUT <> S.LIB_PAYS_COTUT OR (D.LIB_PAYS_COTUT IS NULL AND S.LIB_PAYS_COTUT IS NOT NULL) OR (D.LIB_PAYS_COTUT IS NOT NULL AND S.LIB_PAYS_COTUT IS NULL) THEN 1 ELSE 0 END U_LIB_PAYS_COTUT,
    CASE WHEN D.RESULTAT <> S.RESULTAT OR (D.RESULTAT IS NULL AND S.RESULTAT IS NOT NULL) OR (D.RESULTAT IS NOT NULL AND S.RESULTAT IS NULL) THEN 1 ELSE 0 END U_RESULTAT,
    CASE WHEN D.SOUTENANCE_AUTORIS <> S.SOUTENANCE_AUTORIS OR (D.SOUTENANCE_AUTORIS IS NULL AND S.SOUTENANCE_AUTORIS IS NOT NULL) OR (D.SOUTENANCE_AUTORIS IS NOT NULL AND S.SOUTENANCE_AUTORIS IS NULL) THEN 1 ELSE 0 END U_SOUTENANCE_AUTORIS,
    CASE WHEN D.TEM_AVENANT_COTUT <> S.TEM_AVENANT_COTUT OR (D.TEM_AVENANT_COTUT IS NULL AND S.TEM_AVENANT_COTUT IS NOT NULL) OR (D.TEM_AVENANT_COTUT IS NOT NULL AND S.TEM_AVENANT_COTUT IS NULL) THEN 1 ELSE 0 END U_TEM_AVENANT_COTUT,
    CASE WHEN D.TITRE <> S.TITRE OR (D.TITRE IS NULL AND S.TITRE IS NOT NULL) OR (D.TITRE IS NOT NULL AND S.TITRE IS NULL) THEN 1 ELSE 0 END U_TITRE,
    CASE WHEN D.UNITE_RECH_ID <> S.UNITE_RECH_ID OR (D.UNITE_RECH_ID IS NULL AND S.UNITE_RECH_ID IS NOT NULL) OR (D.UNITE_RECH_ID IS NOT NULL AND S.UNITE_RECH_ID IS NULL) THEN 1 ELSE 0 END U_UNITE_RECH_ID
FROM
  THESE D
  FULL JOIN SRC_THESE S ON S.source_id = D.source_id AND S.source_code = D.source_code
WHERE
       (S.source_code IS NOT NULL AND D.source_code IS NOT NULL AND D.histo_destruction IS NOT NULL AND D.histo_destruction <= SYSDATE)
    OR (S.source_code IS NULL AND D.source_code IS NOT NULL AND (D.histo_destruction IS NULL OR D.histo_destruction > SYSDATE))
    OR (S.source_code IS NOT NULL AND D.source_code IS NULL)
  OR D.CORREC_AUTORISEE <> S.CORREC_AUTORISEE OR (D.CORREC_AUTORISEE IS NULL AND S.CORREC_AUTORISEE IS NOT NULL) OR (D.CORREC_AUTORISEE IS NOT NULL AND S.CORREC_AUTORISEE IS NULL)
  OR D.DATE_ABANDON <> S.DATE_ABANDON OR (D.DATE_ABANDON IS NULL AND S.DATE_ABANDON IS NOT NULL) OR (D.DATE_ABANDON IS NOT NULL AND S.DATE_ABANDON IS NULL)
  OR D.DATE_AUTORIS_SOUTENANCE <> S.DATE_AUTORIS_SOUTENANCE OR (D.DATE_AUTORIS_SOUTENANCE IS NULL AND S.DATE_AUTORIS_SOUTENANCE IS NOT NULL) OR (D.DATE_AUTORIS_SOUTENANCE IS NOT NULL AND S.DATE_AUTORIS_SOUTENANCE IS NULL)
  OR D.DATE_FIN_CONFID <> S.DATE_FIN_CONFID OR (D.DATE_FIN_CONFID IS NULL AND S.DATE_FIN_CONFID IS NOT NULL) OR (D.DATE_FIN_CONFID IS NOT NULL AND S.DATE_FIN_CONFID IS NULL)
  OR D.DATE_PREM_INSC <> S.DATE_PREM_INSC OR (D.DATE_PREM_INSC IS NULL AND S.DATE_PREM_INSC IS NOT NULL) OR (D.DATE_PREM_INSC IS NOT NULL AND S.DATE_PREM_INSC IS NULL)
  OR D.DATE_PREV_SOUTENANCE <> S.DATE_PREV_SOUTENANCE OR (D.DATE_PREV_SOUTENANCE IS NULL AND S.DATE_PREV_SOUTENANCE IS NOT NULL) OR (D.DATE_PREV_SOUTENANCE IS NOT NULL AND S.DATE_PREV_SOUTENANCE IS NULL)
  OR D.DATE_SOUTENANCE <> S.DATE_SOUTENANCE OR (D.DATE_SOUTENANCE IS NULL AND S.DATE_SOUTENANCE IS NOT NULL) OR (D.DATE_SOUTENANCE IS NOT NULL AND S.DATE_SOUTENANCE IS NULL)
  OR D.DATE_TRANSFERT <> S.DATE_TRANSFERT OR (D.DATE_TRANSFERT IS NULL AND S.DATE_TRANSFERT IS NOT NULL) OR (D.DATE_TRANSFERT IS NOT NULL AND S.DATE_TRANSFERT IS NULL)
  OR D.DOCTORANT_ID <> S.DOCTORANT_ID OR (D.DOCTORANT_ID IS NULL AND S.DOCTORANT_ID IS NOT NULL) OR (D.DOCTORANT_ID IS NOT NULL AND S.DOCTORANT_ID IS NULL)
  OR D.ECOLE_DOCT_ID <> S.ECOLE_DOCT_ID OR (D.ECOLE_DOCT_ID IS NULL AND S.ECOLE_DOCT_ID IS NOT NULL) OR (D.ECOLE_DOCT_ID IS NOT NULL AND S.ECOLE_DOCT_ID IS NULL)
  OR D.ETABLISSEMENT_ID <> S.ETABLISSEMENT_ID OR (D.ETABLISSEMENT_ID IS NULL AND S.ETABLISSEMENT_ID IS NOT NULL) OR (D.ETABLISSEMENT_ID IS NOT NULL AND S.ETABLISSEMENT_ID IS NULL)
  OR D.ETAT_THESE <> S.ETAT_THESE OR (D.ETAT_THESE IS NULL AND S.ETAT_THESE IS NOT NULL) OR (D.ETAT_THESE IS NOT NULL AND S.ETAT_THESE IS NULL)
  OR D.LIB_DISC <> S.LIB_DISC OR (D.LIB_DISC IS NULL AND S.LIB_DISC IS NOT NULL) OR (D.LIB_DISC IS NOT NULL AND S.LIB_DISC IS NULL)
  OR D.LIB_ETAB_COTUT <> S.LIB_ETAB_COTUT OR (D.LIB_ETAB_COTUT IS NULL AND S.LIB_ETAB_COTUT IS NOT NULL) OR (D.LIB_ETAB_COTUT IS NOT NULL AND S.LIB_ETAB_COTUT IS NULL)
  OR D.LIB_PAYS_COTUT <> S.LIB_PAYS_COTUT OR (D.LIB_PAYS_COTUT IS NULL AND S.LIB_PAYS_COTUT IS NOT NULL) OR (D.LIB_PAYS_COTUT IS NOT NULL AND S.LIB_PAYS_COTUT IS NULL)
  OR D.RESULTAT <> S.RESULTAT OR (D.RESULTAT IS NULL AND S.RESULTAT IS NOT NULL) OR (D.RESULTAT IS NOT NULL AND S.RESULTAT IS NULL)
  OR D.SOUTENANCE_AUTORIS <> S.SOUTENANCE_AUTORIS OR (D.SOUTENANCE_AUTORIS IS NULL AND S.SOUTENANCE_AUTORIS IS NOT NULL) OR (D.SOUTENANCE_AUTORIS IS NOT NULL AND S.SOUTENANCE_AUTORIS IS NULL)
  OR D.TEM_AVENANT_COTUT <> S.TEM_AVENANT_COTUT OR (D.TEM_AVENANT_COTUT IS NULL AND S.TEM_AVENANT_COTUT IS NOT NULL) OR (D.TEM_AVENANT_COTUT IS NOT NULL AND S.TEM_AVENANT_COTUT IS NULL)
  OR D.TITRE <> S.TITRE OR (D.TITRE IS NULL AND S.TITRE IS NOT NULL) OR (D.TITRE IS NOT NULL AND S.TITRE IS NULL)
  OR D.UNITE_RECH_ID <> S.UNITE_RECH_ID OR (D.UNITE_RECH_ID IS NULL AND S.UNITE_RECH_ID IS NOT NULL) OR (D.UNITE_RECH_ID IS NOT NULL AND S.UNITE_RECH_ID IS NULL)
) diff JOIN source on source.id = diff.source_id WHERE import_action IS NOT NULL AND source.importable = 1
;

alter table THESE drop column ANNEE_UNIV_1ERE_INSC ;

--
-- Corrections de vues SRC pour le nouveau module unicaen/db-import.
--
create or replace view SRC_STRUCTURE as
SELECT
  NULL              AS id,
  tmp.SOURCE_CODE   as SOURCE_CODE,
  tmp.id            as CODE,
  src.id            AS SOURCE_ID,
  ts.id             as TYPE_STRUCTURE_ID,
  tmp.SIGLE,
  tmp.LIBELLE
  --tmp.CODE_PAYS,
  --tmp.LIBELLE_PAYS
FROM TMP_STRUCTURE tmp
       JOIN TYPE_STRUCTURE ts on ts.CODE = tmp.TYPE_STRUCTURE_ID
       JOIN SOURCE src ON src.CODE = tmp.SOURCE_ID
;

--
-- Modification de colonnes posant problème au module unicaen/import.
--
alter table ACTEUR modify HISTO_MODIFICATEUR_ID default null null;
alter table ACTEUR modify HISTO_MODIFICATION default null null;
alter table DOCTORANT modify HISTO_MODIFICATEUR_ID default null null;
alter table DOCTORANT modify HISTO_MODIFICATION default null null;
alter table ECOLE_DOCT modify HISTO_MODIFICATEUR_ID default null null;
alter table ECOLE_DOCT modify HISTO_MODIFICATION default null null;
alter table ETABLISSEMENT modify HISTO_MODIFICATEUR_ID default null null;
alter table ETABLISSEMENT modify HISTO_MODIFICATION default null null;
alter table FINANCEMENT modify HISTO_MODIFICATEUR_ID default null null;
alter table FINANCEMENT modify HISTO_MODIFICATION default null null;
alter table INDIVIDU modify HISTO_MODIFICATEUR_ID default null null;
alter table INDIVIDU modify HISTO_MODIFICATION default null null;
alter table ROLE modify HISTO_MODIFICATEUR_ID default null null;
alter table ROLE modify HISTO_MODIFICATION default null null;
alter table STRUCTURE modify HISTO_MODIFICATEUR_ID default null null;
alter table STRUCTURE modify HISTO_MODIFICATION default null null;
alter table THESE modify HISTO_MODIFICATEUR_ID default null null;
alter table THESE modify HISTO_MODIFICATION default null null;
alter table THESE_ANNEE_UNIV modify HISTO_MODIFICATEUR_ID default null null;
alter table THESE_ANNEE_UNIV modify HISTO_MODIFICATION default null null;
alter table TITRE_ACCES modify HISTO_MODIFICATEUR_ID default null null;
alter table TITRE_ACCES modify HISTO_MODIFICATION default null null;
alter table UNITE_RECH modify HISTO_MODIFICATEUR_ID default null null;
alter table UNITE_RECH modify HISTO_MODIFICATION default null null;
alter table VARIABLE modify HISTO_MODIFICATEUR_ID default null null;
alter table VARIABLE modify HISTO_MODIFICATION default null null;


--
-- Refonte des tables d'observation de la synchro.
-- NB: Parmi les instructions suivantes, vous pouvez ignorer celles qui échouent.
--
alter table IMPORT_OBSERV_ETAB_RESULT rename constraint IMPORT_OBSERV_RESULT_PK to IMPORT_OBSERV_ETAB_RESULT_PK;
alter table IMPORT_OBSERV_ETAB_RESULT rename constraint IMPORT_OBSERV_RESULT_IOE_FK to IMPORT_OBSERV_ETAB_RESU_IOE_FK;
alter index IMPORT_OBSERV_RESULT_PK rename to IMPORT_OBSERV_ETAB_RESULT_PK;
rename IMPORT_OBSERV_RESULT_ID_SEQ to IMPORT_OBSERV_ETAB_RESU_ID_SEQ;
alter table IMPORT_OBSERV add ENABLED NUMBER(1) default 0 not null;
create sequence IMPORT_OBSERV_RESULT_ID_SEQ;

alter table IMPORT_OBSERV add FILTER CLOB;

update IMPORT_OBSERV set ENABLED = 1;
update IMPORT_OBSERV set FILTER = q'#ETABLISSEMENT_ID IN (SELECT ID FROM ETABLISSEMENT WHERE SOURCE_CODE = 'UCN')#';

create table IMPORT_OBSERV_RESULT (
    ID NUMBER not null constraint IMPORT_OBSERV_RESULT_PK primary key,
    IMPORT_OBSERV_ID NUMBER not null constraint IMPORT_OBSERV_RESULT_IOE_FK references IMPORT_OBSERV on delete cascade,
    DATE_CREATION DATE default SYSDATE not null,
    SOURCE_CODE VARCHAR2(64 char) not null,
    RESULTAT CLOB not null,
    DATE_NOTIF date,        -- colonne provisoire
    DATE_LIMITE_NOTIF date, -- colonne provisoire
    Z_IOER_ID NUMBER -- colonne provisoire pour migration
);
create sequence IMPORT_OBSERV_RESULT_ID_SEQ;

insert into IMPORT_OBSERV_RESULT (ID, IMPORT_OBSERV_ID, DATE_CREATION, SOURCE_CODE, RESULTAT, DATE_NOTIF, DATE_LIMITE_NOTIF, Z_IOER_ID)
select IMPORT_OBSERV_RESULT_ID_SEQ.nextval, io.id, DATE_CREATION, SOURCE_CODE, RESULTAT, DATE_NOTIF, DATE_CREATION + interval '1' day, ioer.id
from IMPORT_OBSERV_ETAB_RESULT ioer
join IMPORT_OBSERV_ETAB ioe on ioe.id = ioer.IMPORT_OBSERV_ETAB_ID
join IMPORT_OBSERV io on io.id = ioe.IMPORT_OBSERV_ID
;

rename IMPORT_OBSERV_ETAB_RESULT to Z_IMPORT_OBSERV_ETAB_RESULT;
rename IMPORT_OBSERV_ETAB to Z_IMPORT_OBSERV_ETAB;

--
-- Abandon du package APP_IMPORT.
--
drop package APP_IMPORT;

--
-- Nouveau rôle 'Authentifié·e'.
--
INSERT INTO ROLE (id, CODE, LIBELLE, SOURCE_CODE, SOURCE_ID, ROLE_ID, IS_DEFAULT, ATTRIB_AUTO, THESE_DEP, HISTO_CREATEUR_ID, HISTO_MODIFICATEUR_ID, ORDRE_AFFICHAGE) VALUES
(role_id_seq.nextval, 'user', 'Authentifié·e', 'user', 1, 'user', 0, 0, 0, 1, 1, 'a');

--
-- Nouveau privilège 'consultation-page-couverture'.
--
INSERT INTO PRIVILEGE (ID, CATEGORIE_ID, CODE, LIBELLE, ORDRE) VALUES
(381, 3, 'consultation-page-couverture', 'Consultation de la page de couverture', 3026);



--
-- Associations de privilèges à des profils.
--
INSERT INTO PROFIL_PRIVILEGE (PRIVILEGE_ID, PROFIL_ID)
    with data(categ, priv) as (
        select 'these', 'consultation-page-couverture' from dual /*union
        select 'xxxxx', 'xxx' from dual*/
    )
    select p.id as PRIVILEGE_ID, profil.id as PROFIL_ID
    from data
    join PROFIL on profil.ROLE_ID in (
        'ADMIN_TECH',
        'BDD', 'BU',
        'D', 'DOCTORANT', 'K', 'M', 'R',
        'ED', 'UR'
    )
    join CATEGORIE_PRIVILEGE cp on cp.CODE = data.categ
    join PRIVILEGE p on p.CATEGORIE_ID = cp.id and p.code = data.priv
    where not exists (
        select * from PROFIL_PRIVILEGE where PRIVILEGE_ID = p.id and PROFIL_ID = profil.id
    ) ;

--
-- Affectation de profils à des rôles.
-- NB: penser à créer ensuite les ROLE_PRIVILEGE.
--
insert into PROFIL_TO_ROLE (PROFIL_ID, ROLE_ID)
    with data(PROFIL_CODE, ROLE_ROLE_ID) as (
        select 'BDD', 'Maison du doctorat UCN' from dual union
        select 'BDD', 'Maison du doctorat URN' from dual union
        select 'BDD', 'Maison du doctorat ULHN' from dual union
        select 'BDD', 'Maison du doctorat INSA' from dual
    )
    select pr.id, r.id
    from data
    join PROFIL pr on pr.ROLE_ID = data.PROFIL_CODE
    join role r on r.ROLE_ID = data.ROLE_ROLE_ID
    where not exists (
        select * from PROFIL_TO_ROLE where PROFIL_ID = pr.id and ROLE_ID = r.id
    ) ;

--
-- Attribution automatique des privilèges aux rôles (ROLE_PRIVILEGE) tel que spécifié dans :
--   - PROFIL_TO_ROLE (profils appliqués à chaque rôle) et
--   - PROFIL_PRIVILEGE (privilèges accordés à chaque profil).
--
insert into ROLE_PRIVILEGE (ROLE_ID, PRIVILEGE_ID)
select p2r.ROLE_ID, pp.PRIVILEGE_ID
from PROFIL_TO_ROLE p2r
join profil pr on pr.id = p2r.PROFIL_ID
join PROFIL_PRIVILEGE pp on pp.PROFIL_ID = pr.id
where not exists (
    select * from role_privilege where role_id = p2r.role_id and privilege_id = pp.privilege_id
)
;

--
-- Listes de diffusion.
--
create table LISTE_DIFF
(
    ID NUMBER not null constraint LISTE_DIFF_PK primary key,
    ADRESSE VARCHAR2(256) not null,
    ENABLED NUMBER(1) default 0 not null,
    HISTO_CREATION DATE default SYSDATE not null,
    HISTO_CREATEUR_ID NUMBER not null,
    HISTO_MODIFICATION DATE default SYSDATE not null,
    HISTO_MODIFICATEUR_ID NUMBER not null,
    HISTO_DESTRUCTION DATE,
    HISTO_DESTRUCTEUR_ID NUMBER
);
create unique index LISTE_DIFF_ADRESSE_UN
    on LISTE_DIFF (ADRESSE);
alter table LISTE_DIFF
    add constraint LISTE_DIFF_HC_FK
        foreign key (HISTO_CREATEUR_ID) references UTILISATEUR;
alter table LISTE_DIFF
    add constraint LISTE_DIFF_HM_FK
        foreign key (HISTO_MODIFICATEUR_ID) references UTILISATEUR;
alter table LISTE_DIFF
    add constraint LISTE_DIFF_HD_FK
        foreign key (HISTO_DESTRUCTEUR_ID) references UTILISATEUR;
CREATE SEQUENCE LISTE_DIFF_ID_SEQ;

select replace(sigle,' ','') from STRUCTURE where TYPE_STRUCTURE_ID = 2;

--
-- ED : offres de thèses.
--
alter table ECOLE_DOCT add THEME varchar2(1024);
alter table ECOLE_DOCT add OFFRE_THESE varchar2(2047);

--
-- Bilinguisme
--

alter table INFORMATION add LANGUE_ID varchar2(64);

create table INFORMATION_LANGUE
(
    id varchar2(64) not null,
    libelle varchar2(128),
    drapeau clob
);

create unique index INFORMATION_LANGUE_ID_UINDEX
    on INFORMATION_LANGUE (id);

alter table INFORMATION_LANGUE
    add constraint INFORMATION_LANGUE_PK
        primary key (id);

alter table INFORMATION
    add constraint INFORMATION_LANGUE_ID_FK
        foreign key (LANGUE_ID) references INFORMATION_LANGUE;

INSERT INTO INFORMATION_LANGUE (ID, LIBELLE, DRAPEAU) VALUES ('FR', 'Français', 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDAiIGhlaWdodD0iNjAwIj48cmVjdCB3aWR0aD0iOTAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iI0VEMjkzOSIvPjxyZWN0IHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjZmZmIi8+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSI2MDAiIGZpbGw9IiMwMDIzOTUiLz48L3N2Zz4K');
INSERT INTO INFORMATION_LANGUE (ID, LIBELLE, DRAPEAU) VALUES ('EN', 'English', 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgNjAgMzAiIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjYwMCI+CjxjbGlwUGF0aCBpZD0icyI+Cgk8cGF0aCBkPSJNMCwwIHYzMCBoNjAgdi0zMCB6Ii8+CjwvY2xpcFBhdGg+CjxjbGlwUGF0aCBpZD0idCI+Cgk8cGF0aCBkPSJNMzAsMTUgaDMwIHYxNSB6IHYxNSBoLTMwIHogaC0zMCB2LTE1IHogdi0xNSBoMzAgeiIvPgo8L2NsaXBQYXRoPgo8ZyBjbGlwLXBhdGg9InVybCgjcykiPgoJPHBhdGggZD0iTTAsMCB2MzAgaDYwIHYtMzAgeiIgZmlsbD0iIzAxMjE2OSIvPgoJPHBhdGggZD0iTTAsMCBMNjAsMzAgTTYwLDAgTDAsMzAiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSI2Ii8+Cgk8cGF0aCBkPSJNMCwwIEw2MCwzMCBNNjAsMCBMMCwzMCIgY2xpcC1wYXRoPSJ1cmwoI3QpIiBzdHJva2U9IiNDODEwMkUiIHN0cm9rZS13aWR0aD0iNCIvPgoJPHBhdGggZD0iTTMwLDAgdjMwIE0wLDE1IGg2MCIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjEwIi8+Cgk8cGF0aCBkPSJNMzAsMCB2MzAgTTAsMTUgaDYwIiBzdHJva2U9IiNDODEwMkUiIHN0cm9rZS13aWR0aD0iNiIvPgo8L2c+Cjwvc3ZnPgo=');
UPDATE INFORMATION SET LANGUE_ID='FR' WHERE LANGUE_ID IS NULL;
ALTER TABLE INFORMATION MODIFY LANGUE_ID NOT NULL;
``` 